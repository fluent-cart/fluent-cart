var R=Object.defineProperty;var I=c=>{throw TypeError(c)};var x=(c,t,e)=>t in c?R(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var C=(c,t,e)=>x(c,typeof t!="symbol"?t+"":t,e),S=(c,t,e)=>t.has(c)||I("Cannot "+e);var n=(c,t,e)=>(S(c,t,"read from private field"),e?e.call(c):t.get(c)),y=(c,t,e)=>t.has(c)?I("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(c):t.set(c,e),p=(c,t,e,o)=>(S(c,t,"write to private field"),o?o.call(c,e):t.set(c,e),e),B=(c,t,e)=>(S(c,t,"access private method"),e);const g=class g{static handleFragments(t){let e=!1;t.forEach(o=>{const s=document.querySelector(o.selector);s&&(o.selector&&o.type==="replace"&&(e=!0),o.type==="replace"?s.innerHTML=o.content:s.insertAdjacentHTML("beforeend",o.content))}),e&&setTimeout(()=>{window.dispatchEvent(new CustomEvent("fluentCartFragmentsReplaced",{detail:{selectors:t.filter(o=>o.type==="replace").map(o=>o.selector)}}))},10),window.dispatchEvent(new CustomEvent("fluentCartNotifySummaryViewUpdated"))}static handleSummaryViewUpdated(){fetch(g.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=get_checkout_summary_view`).toString(),{headers:{"X-WP-Nonce":window.fluentCartRestVars.rest.nonce},credentials:"include"}).then(t=>t.json()).then(t=>{this.handleFragments(t.fragments),window.dispatchEvent(new CustomEvent("fluentCartCheckoutDataChanged",{detail:{response:t}}))}).catch(t=>{console.error("Error rendering checkout summary:",t)})}static getParams(){var r,a;const t=new URLSearchParams(window.location.search),e={};t.has("fct_cart_hash")&&(e.fct_cart_hash=t.get("fct_cart_hash")),t.has("quantity")&&(e.quantity=t.get("quantity"));const o=(r=window.fluentCartCouponService)==null?void 0:r.getCoupons();Array.isArray(o)&&o.length>0&&(e.coupons=o.join(","));const s=(a=window.fluent_cart_shipping_service)==null?void 0:a.currentShippingMethodId;return s&&(e.shipping_method_id=s),e}static buildUrl(t,e={}){const o={get(s,r){return r==="toString"||r==="valueOf"||r===Symbol.toPrimitive?()=>g._build(s.rawUrl,e):r==="rawUrl"?s.rawUrl:Reflect.get(s,r)}};return new Proxy({rawUrl:t},o)}static _build(t,e){var s,r;const o=new URLSearchParams(window.location.search);g.quantity==null&&(g.quantity=o.get("quantity")||1);for(const[a,d]of Object.entries(e))o.set(a,d);try{const a=new URL(t);for(const[b,v]of o)a.searchParams.set(b,v);a.searchParams.set("quantity",g.quantity);const d=(s=window.fluentCartCouponService)==null?void 0:s.getCoupons();Array.isArray(d)&&d.length>0&&a.searchParams.set("coupons",d.join(","));const u=(r=window.fluent_cart_shipping_service)==null?void 0:r.currentShippingMethodId;return u&&a.searchParams.set("shipping_method_id",u),a.href}catch(a){return console.error("Error building URL:",a),t}}};C(g,"quantity",null);let A=g;var i,L,M,E,P,k,m,h,w,q,U;class j{constructor({form:t,orderHandler:e,checkoutHandler:o=null,customPayment:s=!1}){y(this,q);y(this,i);C(this,"payMethod");y(this,L,`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=get_order_info`);y(this,M);C(this,"checkoutHandler");C(this,"customPayment");y(this,E);y(this,P,null);y(this,k,!1);y(this,m,!1);y(this,h,null);y(this,w,window.fluentcart.$t);var a,d,u,b,v;p(this,M,e),p(this,i,t),this.payMethod=(a=n(this,i).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:a.value,this.checkoutHandler=o,p(this,h,o.checkoutUiService),this.customPayment=s,p(this,k,((d=window.fluentcart_checkout_info)==null?void 0:d.is_zero_payment)==="yes"),p(this,m,((u=window.fluentcart_checkout_info)==null?void 0:u.has_subscription)==="yes"),this.buttons=n(this,i).querySelector("[data-fluent-cart-checkout-page-checkout-button]"),this.paymenMethodsWithCustomCheckoutButtons=Array.isArray((b=window.fluentcart_checkout_vars)==null?void 0:b.payment_methods_with_custom_checkout_buttons)?window.fluentcart_checkout_vars.payment_methods_with_custom_checkout_buttons:[],p(this,E,(v=window.fluentcart_checkout_vars)==null?void 0:v.submit_button);const r=n(this,i).querySelector('input[name="_fct_pay_method"]:checked');if(r)this.payMethod=r.value;else{const l=n(this,i).querySelector('input[name="_fct_pay_method"]');l&&(this.payMethod=l.value)}this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)&&(n(this,h).hideCheckoutButton(),n(this,h).enableCheckoutButton()),this.bindPaymentMethodListeners(),window.addEventListener("fluentCartCheckoutDataChanged",l=>{var f;this.checkTotal((f=l.detail)==null?void 0:f.response)}),window.addEventListener("fluentCartFragmentsReplaced",l=>{var f,_;(_=(f=l.detail)==null?void 0:f.selectors)!=null&&_.includes("[data-fluent-cart-checkout-payment-methods]")&&this.reinitializePaymentMethods()}),window.addEventListener("fluent_cart_payment_method_loading",l=>{const f=l.detail.payment_method;f&&(document.querySelectorAll(".fct_payment_method_wrapper").forEach(_=>{_.classList.remove("fct-payment-loading"),_.classList.remove("fct-payment-loading-failed")}),document.querySelectorAll(".fct_payment_method_"+f).forEach(_=>{_.classList.add("fct-payment-loading")}))}),window.addEventListener("fluent_cart_payment_method_loading_failed",l=>{const f=l.detail.payment_method;f&&document.querySelectorAll(".fct_payment_method_"+f).forEach(_=>{_.classList.remove("fct-payment-loading"),_.classList.add("fct-payment-loading-failed")})}),window.addEventListener("fluent_cart_payment_method_loading_success",l=>{const f=l.detail.payment_method;f&&document.querySelectorAll(".fct_payment_method_"+f).forEach(_=>{_.classList.remove("fct-payment-loading"),_.classList.remove("fct-payment-loading-failed")})})}reinitializePaymentMethods(){var o;const t=this.payMethod;this.payMethod=((o=n(this,i).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:o.value)||t,this.bindPaymentMethodListeners();const e=n(this,i).querySelector('input[name="_fct_pay_method"]:checked');if(e){B(this,q,U).call(this,e,n(this,i).querySelectorAll('input[name="_fct_pay_method"]'));const s=e.parentNode;if(s.querySelector(".fluent-cart-checkout_embed_payment_container")){document.querySelectorAll(".fct_payment_method_instructions").forEach(u=>u.style.display="none");const d=s.querySelector(".fct_payment_method_instructions");d&&(d.style.display="block")}this.load(this.payMethod)}this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)?(n(this,h).hideCheckoutButton(),n(this,h).enableCheckoutButton()):(n(this,h).showCheckoutButton(),n(this,h).enableCheckoutButton())}bindPaymentMethodListeners(){const t=n(this,i).querySelectorAll('input[name="_fct_pay_method"]');t.forEach(e=>{e.addEventListener("change",()=>{var r;if(this.payMethod=(r=n(this,i).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:r.value,B(this,q,U).call(this,e,t),this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)?(n(this,h).hideCheckoutButton(),n(this,h).enableCheckoutButton()):(n(this,h).showCheckoutButton(),n(this,h).enableCheckoutButton()),document.querySelectorAll(".fct_payment_method_instructions").forEach(a=>{a.style.display="none"}),e.parentNode.querySelector(".fluent-cart-checkout_embed_payment_container")){const a=e.parentNode.querySelector(".fct_payment_method_instructions");a&&(a.style.display="block")}this.load(this.payMethod)})})}checkTotal(t){(t==null?void 0:t.total)!==n(this,P)&&((t==null?void 0:t.total)>0?p(this,k,!1):(t==null?void 0:t.total)<=0&&!n(this,m)&&p(this,k,!0),p(this,P,t==null?void 0:t.total),this.togglePaymentMethods(t))}decodeHtml(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}togglePaymentMethods(t,e=!1){var s;let o=0;if(e?(o=0,p(this,m,!1)):(o=t==null?void 0:t.total,p(this,m,!!(t!=null&&t.has_subscriptions))),!n(this,m)&&o<=0){if(n(this,i).querySelectorAll('input[name="_fct_pay_method"]').length===0)return;const a=n(this,i).querySelector("[data-fluent-cart-checkout-payment-methods]");a.style.display="none",this.payMethod="offline_payment",n(this,i).querySelector('input[name="_fct_pay_method"]').checked=!1,n(this,i).querySelectorAll('input[name="_fct_pay_method"]').forEach(d=>{d.checked=!1,d.removeAttribute("checked")}),window.is_offline_payment_ready=!0,n(this,h).showCheckoutButton(),n(this,h).enableCheckoutButton()}else{const r=n(this,i).querySelector("[data-fluent-cart-checkout-payment-methods]");r.style.display="block";let a=(s=n(this,i).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:s.value;if(this.payMethod=a,a)this.load(a);else{const d=n(this,i).querySelector('input[name="_fct_pay_method"]');d&&(d.checked=!0,this.payMethod=d.value,d.setAttribute("aria-checked","true"),d.dispatchEvent(new Event("change",{bubbles:!0})),this.load())}}}disableCheckoutButton(t){n(this,i).classList.add("fluent-cart-checkout-order-processing"),n(this,h).disableCheckoutButton(),n(this,h).setCheckoutButtonText(t)}enableCheckoutButton(t){n(this,i).classList.add("fluent-cart-checkout-order-processing"),n(this,h).enableCheckoutButton(),n(this,h).setCheckoutButtonText(t)}showCheckoutButton(){this.buttons.style.display="block",this.buttons.disabled=!1}triggerPaymentCompleteEvent(t){var s;const e=new URLSearchParams({action:"fluent_cart_run_order_actions",order_hash:(s=t==null?void 0:t.order)==null?void 0:s.uuid}),o=new XMLHttpRequest;o.open("POST",window.fluentcart_checkout_vars.ajaxurl,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onload=function(){o.status>=200&&o.status<300||console.error("Network response was not ok")},o.send(e.toString())}load(t){var a,d;if(t==null){const u=n(this,i).querySelector('input[name="_fct_pay_method"]');if(u){t=u.value,u.checked=!0,n(this,i).querySelectorAll('input[name="_fct_pay_method"]').forEach(l=>{l.parentNode.classList.remove("active")}),u.parentNode.classList.add("active"),u.setAttribute("aria-checked","true");const b=u.parentNode;b.querySelector(".fluent-cart-checkout_embed_payment_container");const v=b.querySelector(".fct_payment_method_instructions");v&&(document.querySelectorAll(".fct_payment_method_instructions").forEach(l=>{l.style.display="none"}),v.style.display="block")}else return}if(this.payMethod=t,n(this,k)&&!n(this,m))return this.togglePaymentMethods({},!0);window["is_"+t+"_ready"]=!0;let e=new URLSearchParams(window.location.search);const o=n(this,L);let s={method:t};(a=window.fluentcart_checkout_info)!=null&&a.paymentMode&&(s.mode=window.fluentcart_checkout_info.paymentMode),(d=window.fluentcart_checkout_info)!=null&&d.orderHash&&(s.order_hash=window.fluentcart_checkout_info.orderHash),e.has("mode")&&e.get("variation_id")&&(s.mode=e.get("mode"),s.variation_id=e.get("variation_id"));const r=A.buildUrl(o.toString(),s).toString();window.dispatchEvent(new CustomEvent("fluent_cart_load_payments_"+t,{detail:{form:n(this,i),paymentInfoUrl:r,nonce:window.fluentcart_checkout_info.checkout_nonce,orderHandler:n(this,M),paymentLoader:this,isZeroPayment:n(this,k),hasSubscriptions:n(this,m)}}))}changeLoaderStatus(t){const e=document.querySelector(".fct-order-processing .loading-status");if(!e)return;const o={processing:n(this,w).call(this,"Payment Processing..."),confirming:n(this,w).call(this,"Confirming Payment..."),completed:n(this,w).call(this,"Payment completed! Updating order..."),redirecting:n(this,w).call(this,"Redirecting to receipt..."),failed:n(this,w).call(this,"Payment failed!"),canceled:n(this,w).call(this,"Payment canceled!"),rejected:n(this,w).call(this,"Payment Process rejected!")};e.textContent=o[t]||t}hideLoader(){const t=document.querySelector(".fct-order-processing");t&&t.classList.add("hidden")}getPaymentMethod(){return this.payMethod}}i=new WeakMap,L=new WeakMap,M=new WeakMap,E=new WeakMap,P=new WeakMap,k=new WeakMap,m=new WeakMap,h=new WeakMap,w=new WeakMap,q=new WeakSet,U=function(t,e){e.forEach(o=>{const s=o===t;o.parentNode.classList.toggle("active",s),o.setAttribute("aria-checked",s?"true":"false"),s||(o.checked=!1)}),t.checked=!0};export{A as C,j as P};
